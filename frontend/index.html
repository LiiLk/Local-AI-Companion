<!DOCTYPE html>
<html lang="fr" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Aria - Your private, local AI companion">
    <meta name="theme-color" content="#6366f1">

    <title>Juri - Local AI Companion</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css?v=2">

    <!-- Favicon -->
    <link rel="icon" href="assets/juri_avatar.png?v=2">
</head>

<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="assets/juri_avatar.png?v=2" alt="Juri" class="logo-avatar" width="32" height="32">
                    <span class="logo-text">Juri</span>
                </div>
                <button class="icon-btn sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
            </div>

            <!-- Connection Status -->
            <div class="connection-card" id="connection-card">
                <!-- ... kept same ... -->
                <div class="connection-status" id="connection-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
                <div class="models-status" id="models-status">
                    <div class="model-item" data-model="vad" data-status="pending">
                        <span>VAD</span>
                        <span class="model-badge">‚Äî</span>
                    </div>
                    <div class="model-item" data-model="asr" data-status="pending">
                        <span>ASR</span>
                        <span class="model-badge">‚Äî</span>
                    </div>
                    <div class="model-item" data-model="tts" data-status="pending">
                        <span>TTS</span>
                        <span class="model-badge">‚Äî</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <nav class="sidebar-nav">
                <button class="nav-item" id="new-chat-btn" title="New conversation">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="12" y1="8" x2="12" y2="16" />
                        <line x1="8" y1="12" x2="16" y2="12" />
                    </svg>
                    <span>New Chat</span>
                </button>
                <button class="nav-item" id="settings-btn" title="Settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                    <span>Actions</span>
                </button>
            </nav>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <button class="nav-item" id="theme-toggle" title="Toggle theme">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="icon-moon">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                    <span>Dark Mode</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat Header -->
            <header class="chat-header">
                <button class="icon-btn mobile-menu-btn" id="mobile-menu-btn" aria-label="Open menu">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg>
                </button>
                <div class="chat-title">
                    <img src="assets/juri_avatar.png?v=2" alt="Juri" class="header-avatar" width="44" height="44">
                    <div>
                        <h1>Juri</h1>
                        <span class="chat-subtitle">Street Fighter ‚Ä¢ Sarcastic AI</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="icon-btn" id="clear-chat-btn" title="Clear conversation">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6" />
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Messages Area -->
            <div class="messages-container" id="messages-container">
                <div class="messages" id="messages">
                    <!-- Welcome Message -->
                    <div class="message assistant welcome-message">
                        <div class="message-avatar">
                            <img src="assets/juri_avatar.png" class="avatar-img">
                        </div>
                        <div class="message-bubble">
                            <div class="message-content">
                                <p><strong>Salut, loser !</strong> üòè</p>
                                <p>Juri Han √† l'appareil. Pr√™t √† souffrir un peu ? Ou tu veux juste que je t'aide ?</p>
                                <p class="hint">Parle-moi si t'oses.</p>
                            </div>
                            <div class="message-meta">
                                <span class="message-time">Maintenant</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scroll to bottom button -->
                <button class="scroll-to-bottom hidden" id="scroll-to-bottom" aria-label="Scroll to bottom">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9" />
                    </svg>
                </button>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <!-- Status Bar -->
                <div class="status-bar hidden" id="status-bar">
                    <div class="status-content">
                        <span class="status-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                class="spinning">
                                <line x1="12" y1="2" x2="12" y2="6" />
                                <line x1="12" y1="18" x2="12" y2="22" />
                                <line x1="4.93" y1="4.93" x2="7.76" y2="7.76" />
                                <line x1="16.24" y1="16.24" x2="19.07" y2="19.07" />
                                <line x1="2" y1="12" x2="6" y2="12" />
                                <line x1="18" y1="12" x2="22" y2="12" />
                                <line x1="4.93" y1="19.07" x2="7.76" y2="16.24" />
                                <line x1="16.24" y1="7.76" x2="19.07" y2="4.93" />
                            </svg>
                        </span>
                        <span class="status-message" id="status-message">Ready</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>

                <!-- Input Container -->
                <div class="input-wrapper">
                    <div class="input-container">
                        <!-- Voice Button -->
                        <button class="voice-btn" id="voice-btn" title="Click to speak">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                class="mic-icon">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                <line x1="12" y1="19" x2="12" y2="23" />
                                <line x1="8" y1="23" x2="16" y2="23" />
                            </svg>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                class="stop-icon" style="display:none">
                                <rect x="6" y="6" width="12" height="12" rx="2" />
                            </svg>
                            <div class="voice-ripple"></div>
                            <div class="voice-waves">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </button>

                        <!-- Text Input -->
                        <div class="text-input-wrapper">
                            <textarea id="message-input" placeholder="Tapez un message ou cliquez sur le micro..."
                                rows="1" autocomplete="off"></textarea>
                        </div>

                        <!-- Send Button -->
                        <button class="send-btn" id="send-btn" title="Send message" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13" />
                                <polygon points="22 2 15 22 11 13 2 9 22 2" />
                            </svg>
                        </button>
                    </div>

                    <!-- Input Hints -->
                    <div class="input-hints">
                        <span><kbd>Entr√©e</kbd> envoyer</span>
                        <span><kbd>Shift+Entr√©e</kbd> nouvelle ligne</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Settings Panel (Slide-in) -->
        <div class="settings-panel" id="settings-panel">
            <div class="settings-header">
                <h2>Param√®tres</h2>
                <button class="icon-btn" id="close-settings-btn" aria-label="Close settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>

            <div class="settings-content">
                <!-- Voice Settings -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                        </svg>
                        Reconnaissance Vocale (ASR)
                    </h3>
                    <div class="setting-item">
                        <label for="asr-provider">Moteur</label>
                        <select id="asr-provider">
                            <option value="parakeet">Parakeet TDT 0.6B (Rapide)</option>
                            <option value="whisper">Whisper (Pr√©cis)</option>
                            <option value="canary">Canary 1B (Premium)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="asr-language">Langue</label>
                        <select id="asr-language">
                            <option value="">D√©tection auto</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="en">English</option>
                            <option value="de">Deutsch</option>
                            <option value="es">Espa√±ol</option>
                            <option value="ja">Êó•Êú¨Ë™û</option>
                        </select>
                    </div>
                </section>

                <!-- TTS Settings -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14" />
                        </svg>
                        Synth√®se Vocale (TTS)
                    </h3>
                    <div class="setting-item">
                        <label for="tts-provider">Moteur</label>
                        <select id="tts-provider">
                            <option value="xtts">XTTS v2 (Multilingue)</option>
                            <option value="kokoro">Kokoro (Rapide)</option>
                            <option value="edge">Edge TTS (Cloud)</option>
                        </select>
                    </div>
                    <div class="setting-item toggle">
                        <label for="auto-detect-language">
                            D√©tection automatique de la langue
                        </label>
                        <input type="checkbox" id="auto-detect-language" checked>
                    </div>
                    <div class="setting-item toggle">
                        <label for="stream-tts">
                            Streaming audio (r√©ponse plus rapide)
                        </label>
                        <input type="checkbox" id="stream-tts" checked>
                    </div>
                </section>

                <!-- Character Settings -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                        Personnage
                    </h3>
                    <div class="setting-item">
                        <label for="character-name">Nom</label>
                        <input type="text" id="character-name" value="Juri" placeholder="Nom du personnage">
                    </div>
                    <div class="setting-item">
                        <label for="character-prompt">Personnalit√©</label>
                        <textarea id="character-prompt" rows="3"
                            placeholder="D√©crivez la personnalit√©...">You are Juri Han from Street Fighter. You are sarcastic, sadistic, but helpful.</textarea>
                    </div>
                </section>
            </div>

            <div class="settings-footer">
                <button class="btn btn-ghost" id="reset-settings-btn">R√©initialiser</button>
                <button class="btn btn-primary" id="save-settings-btn">Sauvegarder</button>
            </div>
        </div>

        <!-- Overlay for modals/panels -->
        <div class="overlay" id="overlay"></div>
    </div>

    <!-- Audio elements -->
    <audio id="audio-player" style="display: none;"></audio>
    
    <!-- Live2D Container (overlay on right side) -->
    <div id="live2d-container" class="live2d-container">
        <canvas id="live2d-canvas"></canvas>
        <!-- Debug overlay (hidden by default) -->
        <div id="live2d-debug" class="live2d-debug">
            <div>FPS: <span id="fps">0</span></div>
            <div>Expression: <span id="expression-name">neutral</span></div>
            <div>Lip: <span id="lip-value">0.00</span></div>
        </div>
    </div>

    <!-- Live2D Scripts -->
    <script src="/assets/live2d_sdk_web/Core/live2dcubismcore.min.js"></script>
    <script src="/frontend/live2d/live2d.js"></script>
    <script src="/frontend/js/live2d-integration.js"></script>

    <!-- Scripts -->
    <script src="js/websocket.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>

</html>